<mxfile host="app.diagrams.net" modified="2023-04-06T08:55:06.783Z" agent="Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/111.0" etag="d7SGQNStzKLu7pO5vnxz" version="21.1.4" type="device" pages="6">
  <diagram name="Old" id="4avrkyJrO1HF61GQWn7J">
    <mxGraphModel dx="4386" dy="2143" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="0" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="4iE3-iKasyKdXARzK3Ku-3" value="UserAccount&#xa;service" style="whiteSpace=wrap;aspect=fixed;strokeWidth=2;fontFamily=Lucida Console;fontSize=14;" parent="1" vertex="1">
          <mxGeometry x="440" y="80" width="160" height="160" as="geometry" />
        </mxCell>
        <mxCell id="4iE3-iKasyKdXARzK3Ku-4" value="PersistentSession&#xa;service" style="whiteSpace=wrap;aspect=fixed;strokeWidth=2;fontFamily=Lucida Console;fontSize=14;" parent="1" vertex="1">
          <mxGeometry x="440" y="-240" width="160" height="160" as="geometry" />
        </mxCell>
        <mxCell id="4iE3-iKasyKdXARzK3Ku-5" value="" style="endArrow=none;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;" parent="1" source="4iE3-iKasyKdXARzK3Ku-4" target="4iE3-iKasyKdXARzK3Ku-18" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="950" y="-270" as="sourcePoint" />
            <mxPoint x="1040" y="-440" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="4iE3-iKasyKdXARzK3Ku-6" value="" style="endArrow=none;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;" parent="1" source="4iE3-iKasyKdXARzK3Ku-3" target="4iE3-iKasyKdXARzK3Ku-17" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="990" y="470" as="sourcePoint" />
            <mxPoint x="1080" y="479.9999999999998" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="4iE3-iKasyKdXARzK3Ku-8" value="Login&#xa;service" style="whiteSpace=wrap;aspect=fixed;strokeWidth=2;fontFamily=Lucida Console;fontSize=14;" parent="1" vertex="1">
          <mxGeometry x="120" y="-240" width="160" height="160" as="geometry" />
        </mxCell>
        <mxCell id="4iE3-iKasyKdXARzK3Ku-9" value="Logout&#xa;service" style="whiteSpace=wrap;aspect=fixed;strokeWidth=2;fontFamily=Lucida Console;fontSize=14;" parent="1" vertex="1">
          <mxGeometry x="120" y="80" width="160" height="160" as="geometry" />
        </mxCell>
        <mxCell id="4iE3-iKasyKdXARzK3Ku-17" value="UserAccount&#xa;database" style="rounded=1;whiteSpace=wrap;strokeWidth=2;fontFamily=Lucida Console;fontSize=14;" parent="1" vertex="1">
          <mxGeometry x="760" y="80" width="160" height="160" as="geometry" />
        </mxCell>
        <mxCell id="4iE3-iKasyKdXARzK3Ku-18" value="PersistentSession&#xa;database" style="rounded=1;whiteSpace=wrap;strokeWidth=2;fontFamily=Lucida Console;fontSize=14;" parent="1" vertex="1">
          <mxGeometry x="760" y="-240" width="160" height="160" as="geometry" />
        </mxCell>
        <mxCell id="4iE3-iKasyKdXARzK3Ku-22" value="Client" style="ellipse;shape=cloud;whiteSpace=wrap;strokeWidth=2;fontFamily=Lucida Console;fontSize=14;" parent="1" vertex="1">
          <mxGeometry x="-520" y="-80" width="160" height="160" as="geometry" />
        </mxCell>
        <mxCell id="4iE3-iKasyKdXARzK3Ku-23" value="" style="endArrow=none;html=1;rounded=0;exitX=0.875;exitY=0.5;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=2;" parent="1" source="4iE3-iKasyKdXARzK3Ku-22" target="4iE3-iKasyKdXARzK3Ku-24" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-220" y="230" as="sourcePoint" />
            <mxPoint x="-200" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="4iE3-iKasyKdXARzK3Ku-24" value="Gateway" style="shape=trapezoid;perimeter=trapezoidPerimeter;whiteSpace=wrap;fixedSize=1;direction=north;strokeWidth=2;fontFamily=Lucida Console;fontSize=14;" parent="1" vertex="1">
          <mxGeometry x="-200" y="-80" width="160" height="160" as="geometry" />
        </mxCell>
        <mxCell id="4iE3-iKasyKdXARzK3Ku-25" value="/api/login" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;rounded=0;fontSize=14;fontFamily=Lucida Console;" parent="1" vertex="1">
          <mxGeometry x="120" y="-280" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="4iE3-iKasyKdXARzK3Ku-27" value="/api/logout" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;rounded=0;fontSize=14;fontFamily=Lucida Console;" parent="1" vertex="1">
          <mxGeometry x="120" y="40" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="4iE3-iKasyKdXARzK3Ku-28" value="Account&#xa;service" style="whiteSpace=wrap;aspect=fixed;strokeWidth=2;fontFamily=Lucida Console;fontSize=14;" parent="1" vertex="1">
          <mxGeometry x="120" y="400" width="160" height="160" as="geometry" />
        </mxCell>
        <mxCell id="4iE3-iKasyKdXARzK3Ku-31" value="/api/account" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;rounded=0;fontSize=14;fontFamily=Lucida Console;" parent="1" vertex="1">
          <mxGeometry x="120" y="360" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="4iE3-iKasyKdXARzK3Ku-32" value="" style="endArrow=none;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;endFill=0;strokeWidth=2;" parent="1" source="4iE3-iKasyKdXARzK3Ku-8" target="4iE3-iKasyKdXARzK3Ku-3" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="540" y="-400" as="sourcePoint" />
            <mxPoint x="590" y="-450" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="4iE3-iKasyKdXARzK3Ku-33" value="" style="endArrow=none;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;endFill=0;strokeWidth=2;" parent="1" source="4iE3-iKasyKdXARzK3Ku-28" target="4iE3-iKasyKdXARzK3Ku-3" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="300" y="340" as="sourcePoint" />
            <mxPoint x="350" y="290" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="4iE3-iKasyKdXARzK3Ku-34" value="" style="endArrow=none;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;endFill=0;strokeWidth=2;" parent="1" source="4iE3-iKasyKdXARzK3Ku-9" target="4iE3-iKasyKdXARzK3Ku-4" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="300" as="sourcePoint" />
            <mxPoint x="350" y="-50" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="4iE3-iKasyKdXARzK3Ku-35" value="" style="endArrow=none;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;endFill=0;strokeWidth=2;" parent="1" source="4iE3-iKasyKdXARzK3Ku-8" target="4iE3-iKasyKdXARzK3Ku-4" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="280" y="-100" as="sourcePoint" />
            <mxPoint x="330" y="-150" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="4iE3-iKasyKdXARzK3Ku-36" value="" style="endArrow=none;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;endFill=0;strokeWidth=2;" parent="1" source="4iE3-iKasyKdXARzK3Ku-24" target="4iE3-iKasyKdXARzK3Ku-8" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-40" y="-130" as="sourcePoint" />
            <mxPoint x="10" y="-180" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="4iE3-iKasyKdXARzK3Ku-37" value="" style="endArrow=none;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;endFill=0;strokeWidth=2;" parent="1" source="4iE3-iKasyKdXARzK3Ku-24" target="4iE3-iKasyKdXARzK3Ku-9" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-20" y="150" as="sourcePoint" />
            <mxPoint x="30" y="100" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="4iE3-iKasyKdXARzK3Ku-38" value="" style="endArrow=none;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;endFill=0;strokeWidth=2;" parent="1" source="4iE3-iKasyKdXARzK3Ku-24" target="4iE3-iKasyKdXARzK3Ku-28" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="90" y="190" as="sourcePoint" />
            <mxPoint x="140" y="140" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="4iE3-iKasyKdXARzK3Ku-39" value="Identification&#xa;service" style="whiteSpace=wrap;aspect=fixed;strokeWidth=2;fontFamily=Lucida Console;fontSize=14;" parent="1" vertex="1">
          <mxGeometry x="120" y="-560" width="160" height="160" as="geometry" />
        </mxCell>
        <mxCell id="4iE3-iKasyKdXARzK3Ku-40" value="" style="endArrow=none;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;endFill=0;strokeWidth=2;" parent="1" source="4iE3-iKasyKdXARzK3Ku-24" target="4iE3-iKasyKdXARzK3Ku-39" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-150" y="-130" as="sourcePoint" />
            <mxPoint x="-100" y="-180" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="4iE3-iKasyKdXARzK3Ku-42" value="1. Client makes HTTP request with ID token (JWT) in authorization header." style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;fontSize=14;fontFamily=Lucida Console;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="-360" y="80" width="160" height="120" as="geometry" />
        </mxCell>
        <mxCell id="4iE3-iKasyKdXARzK3Ku-43" value="3. Identification service verifies ID token and extracts PersistentSession ID." style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;fontSize=14;fontFamily=Lucida Console;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="320" y="-560" width="160" height="120" as="geometry" />
        </mxCell>
        <mxCell id="4iE3-iKasyKdXARzK3Ku-44" value="ID token (JWT)" style="swimlane;whiteSpace=wrap;fontFamily=Lucida Console;fontSize=14;" parent="1" vertex="1">
          <mxGeometry x="80" y="-760" width="240" height="160" as="geometry" />
        </mxCell>
        <mxCell id="4iE3-iKasyKdXARzK3Ku-49" value="PersistentSession ID" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" parent="4iE3-iKasyKdXARzK3Ku-44" vertex="1">
          <mxGeometry x="10" y="40" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="4iE3-iKasyKdXARzK3Ku-51" value="Expiration time" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" parent="4iE3-iKasyKdXARzK3Ku-44" vertex="1">
          <mxGeometry x="10" y="80" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="4iE3-iKasyKdXARzK3Ku-71" value="Signature" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" parent="4iE3-iKasyKdXARzK3Ku-44" vertex="1">
          <mxGeometry x="10" y="120" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="4iE3-iKasyKdXARzK3Ku-53" value="" style="endArrow=none;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;endFill=0;strokeWidth=2;" parent="1" source="4iE3-iKasyKdXARzK3Ku-39" target="4iE3-iKasyKdXARzK3Ku-4" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="620" y="-210" as="sourcePoint" />
            <mxPoint x="780" y="-690" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="4iE3-iKasyKdXARzK3Ku-54" value="2. Gateway forwards request to identification service." style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;fontSize=14;fontFamily=Lucida Console;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="-120" y="-400" width="160" height="120" as="geometry" />
        </mxCell>
        <mxCell id="4iE3-iKasyKdXARzK3Ku-55" value="4. Identification service fetches corresponding PersistentSession from PersistentSession service." style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;fontSize=14;fontFamily=Lucida Console;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="400" y="-400" width="160" height="120" as="geometry" />
        </mxCell>
        <mxCell id="4iE3-iKasyKdXARzK3Ku-56" value="PersistentSession" style="swimlane;whiteSpace=wrap;fontFamily=Lucida Console;fontSize=14;" parent="1" vertex="1">
          <mxGeometry x="720" y="-560" width="240" height="280" as="geometry" />
        </mxCell>
        <mxCell id="4iE3-iKasyKdXARzK3Ku-57" value="ID (string)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" parent="4iE3-iKasyKdXARzK3Ku-56" vertex="1">
          <mxGeometry x="10" y="40" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="4iE3-iKasyKdXARzK3Ku-58" value="Creation time (number)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" parent="4iE3-iKasyKdXARzK3Ku-56" vertex="1">
          <mxGeometry x="10" y="200" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="4iE3-iKasyKdXARzK3Ku-59" value="Expiration time (number)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" parent="4iE3-iKasyKdXARzK3Ku-56" vertex="1">
          <mxGeometry x="10" y="240" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="4iE3-iKasyKdXARzK3Ku-60" value="UserAccount ID (string)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" parent="4iE3-iKasyKdXARzK3Ku-56" vertex="1">
          <mxGeometry x="10" y="80" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="4iE3-iKasyKdXARzK3Ku-61" value="Refresh token (string)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" parent="4iE3-iKasyKdXARzK3Ku-56" vertex="1">
          <mxGeometry x="10" y="160" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="4iE3-iKasyKdXARzK3Ku-69" value="Roles (bit flags)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" parent="4iE3-iKasyKdXARzK3Ku-56" vertex="1">
          <mxGeometry x="10" y="120" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="4iE3-iKasyKdXARzK3Ku-62" value="" style="endArrow=none;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;endFill=0;strokeWidth=2;" parent="1" source="4iE3-iKasyKdXARzK3Ku-28" target="4iE3-iKasyKdXARzK3Ku-4" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="290" y="490" as="sourcePoint" />
            <mxPoint x="450" y="170" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="4iE3-iKasyKdXARzK3Ku-63" value="UserAccount" style="swimlane;whiteSpace=wrap;fontFamily=Lucida Console;fontSize=14;" parent="1" vertex="1">
          <mxGeometry x="720" y="280" width="240" height="240" as="geometry" />
        </mxCell>
        <mxCell id="4iE3-iKasyKdXARzK3Ku-64" value="ID (string)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" parent="4iE3-iKasyKdXARzK3Ku-63" vertex="1">
          <mxGeometry x="10" y="40" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="4iE3-iKasyKdXARzK3Ku-65" value="Password salt (string)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" parent="4iE3-iKasyKdXARzK3Ku-63" vertex="1">
          <mxGeometry x="10" y="160" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="4iE3-iKasyKdXARzK3Ku-67" value="Name (string)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" parent="4iE3-iKasyKdXARzK3Ku-63" vertex="1">
          <mxGeometry x="10" y="80" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="4iE3-iKasyKdXARzK3Ku-68" value="Password hash (string)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" parent="4iE3-iKasyKdXARzK3Ku-63" vertex="1">
          <mxGeometry x="10" y="120" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="lMtaDuZxCy8Wa0wxjzj1-1" value="Roles (bit flags)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" parent="4iE3-iKasyKdXARzK3Ku-63" vertex="1">
          <mxGeometry x="10" y="200" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="4iE3-iKasyKdXARzK3Ku-70" value="5. Identification service returns UserAccount ID, roles, and creation time of PersistentSession to gateway." style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;fontSize=14;fontFamily=Lucida Console;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="-80" y="-560" width="160" height="120" as="geometry" />
        </mxCell>
        <mxCell id="4iE3-iKasyKdXARzK3Ku-72" value="6. Gateway forwards original request with UserAccount ID, roles, and creation time of PersistentSession to appropriate service." style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;fontSize=14;fontFamily=Lucida Console;whiteSpace=wrap;" parent="1" vertex="1">
          <mxGeometry x="-160" y="160" width="160" height="120" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram name="Overall" id="apN8GqUbnEpljghqEfl6">
    <mxGraphModel dx="6685" dy="3055" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="0" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0">
      <root>
        <mxCell id="qDMPsKOcjA7EG43ip9Th-0" />
        <mxCell id="qDMPsKOcjA7EG43ip9Th-1" parent="qDMPsKOcjA7EG43ip9Th-0" />
        <mxCell id="qDMPsKOcjA7EG43ip9Th-57" value="" style="swimlane;startSize=0;strokeWidth=2;" vertex="1" parent="qDMPsKOcjA7EG43ip9Th-1">
          <mxGeometry x="-2120" y="-1240" width="720" height="480" as="geometry" />
        </mxCell>
        <mxCell id="qDMPsKOcjA7EG43ip9Th-58" value="Authentication&#xa;service" style="whiteSpace=wrap;aspect=fixed;strokeWidth=2;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="qDMPsKOcjA7EG43ip9Th-57">
          <mxGeometry x="40" y="40" width="160" height="160" as="geometry" />
        </mxCell>
        <mxCell id="qDMPsKOcjA7EG43ip9Th-59" value="PersistentSession&#xa;database" style="rounded=1;whiteSpace=wrap;strokeWidth=2;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="qDMPsKOcjA7EG43ip9Th-57">
          <mxGeometry x="240" y="40" width="160" height="160" as="geometry" />
        </mxCell>
        <mxCell id="qDMPsKOcjA7EG43ip9Th-60" value="PersistentSession" style="swimlane;whiteSpace=wrap;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="qDMPsKOcjA7EG43ip9Th-57">
          <mxGeometry x="440" y="40" width="240" height="280" as="geometry" />
        </mxCell>
        <mxCell id="qDMPsKOcjA7EG43ip9Th-61" value="ID (string)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="qDMPsKOcjA7EG43ip9Th-60">
          <mxGeometry x="10" y="40" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="qDMPsKOcjA7EG43ip9Th-62" value="Creation time (number)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="qDMPsKOcjA7EG43ip9Th-60">
          <mxGeometry x="10" y="200" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="qDMPsKOcjA7EG43ip9Th-63" value="Expiration time (number)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="qDMPsKOcjA7EG43ip9Th-60">
          <mxGeometry x="10" y="240" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="qDMPsKOcjA7EG43ip9Th-64" value="UserAccount ID (string)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="qDMPsKOcjA7EG43ip9Th-60">
          <mxGeometry x="10" y="80" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="qDMPsKOcjA7EG43ip9Th-65" value="Refresh token (string)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="qDMPsKOcjA7EG43ip9Th-60">
          <mxGeometry x="10" y="160" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="qDMPsKOcjA7EG43ip9Th-66" value="Roles (bit flags)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="qDMPsKOcjA7EG43ip9Th-60">
          <mxGeometry x="10" y="120" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="qDMPsKOcjA7EG43ip9Th-67" value="Identify" style="shape=trapezoid;perimeter=trapezoidPerimeter;whiteSpace=wrap;fixedSize=1;strokeWidth=2;fontSize=14;fontFamily=Lucida Console;" vertex="1" parent="qDMPsKOcjA7EG43ip9Th-57">
          <mxGeometry y="440" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="qDMPsKOcjA7EG43ip9Th-68" value="Login" style="shape=trapezoid;perimeter=trapezoidPerimeter;whiteSpace=wrap;fixedSize=1;strokeWidth=2;fontSize=14;fontFamily=Lucida Console;" vertex="1" parent="qDMPsKOcjA7EG43ip9Th-57">
          <mxGeometry x="160" y="440" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="qDMPsKOcjA7EG43ip9Th-69" value="Logout" style="shape=trapezoid;perimeter=trapezoidPerimeter;whiteSpace=wrap;fixedSize=1;strokeWidth=2;fontSize=14;fontFamily=Lucida Console;" vertex="1" parent="qDMPsKOcjA7EG43ip9Th-57">
          <mxGeometry x="320" y="440" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="qDMPsKOcjA7EG43ip9Th-70" value="" style="endArrow=none;html=1;rounded=0;strokeWidth=2;entryX=1;entryY=0.5;entryDx=0;entryDy=0;exitX=0;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="qDMPsKOcjA7EG43ip9Th-57" source="qDMPsKOcjA7EG43ip9Th-59" target="qDMPsKOcjA7EG43ip9Th-58">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="300" y="320" as="sourcePoint" />
            <mxPoint x="180" y="300" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="qDMPsKOcjA7EG43ip9Th-74" value="" style="swimlane;startSize=0;strokeWidth=2;" vertex="1" parent="qDMPsKOcjA7EG43ip9Th-1">
          <mxGeometry x="-1080" y="-1240" width="800" height="480" as="geometry" />
        </mxCell>
        <mxCell id="qDMPsKOcjA7EG43ip9Th-75" value="UserAccount&#xa;service" style="whiteSpace=wrap;aspect=fixed;strokeWidth=2;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="qDMPsKOcjA7EG43ip9Th-74">
          <mxGeometry x="40" y="40" width="160" height="160" as="geometry" />
        </mxCell>
        <mxCell id="qDMPsKOcjA7EG43ip9Th-76" value="UserAccount&#xa;database" style="rounded=1;whiteSpace=wrap;strokeWidth=2;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="qDMPsKOcjA7EG43ip9Th-74">
          <mxGeometry x="240" y="40" width="160" height="160" as="geometry" />
        </mxCell>
        <mxCell id="qDMPsKOcjA7EG43ip9Th-77" value="UserAccount" style="swimlane;whiteSpace=wrap;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="qDMPsKOcjA7EG43ip9Th-74">
          <mxGeometry x="440" y="40" width="240" height="240" as="geometry" />
        </mxCell>
        <mxCell id="qDMPsKOcjA7EG43ip9Th-78" value="ID (string)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="qDMPsKOcjA7EG43ip9Th-77">
          <mxGeometry x="10" y="40" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="qDMPsKOcjA7EG43ip9Th-79" value="Password salt (string)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="qDMPsKOcjA7EG43ip9Th-77">
          <mxGeometry x="10" y="160" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="qDMPsKOcjA7EG43ip9Th-80" value="Name (string)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="qDMPsKOcjA7EG43ip9Th-77">
          <mxGeometry x="10" y="80" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="qDMPsKOcjA7EG43ip9Th-81" value="Password hash (string)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="qDMPsKOcjA7EG43ip9Th-77">
          <mxGeometry x="10" y="120" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="qDMPsKOcjA7EG43ip9Th-82" value="Roles (bit flags)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="qDMPsKOcjA7EG43ip9Th-77">
          <mxGeometry x="10" y="200" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="qDMPsKOcjA7EG43ip9Th-83" value="" style="endArrow=none;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;" edge="1" parent="qDMPsKOcjA7EG43ip9Th-74" source="qDMPsKOcjA7EG43ip9Th-75" target="qDMPsKOcjA7EG43ip9Th-76">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-560" y="1119.29" as="sourcePoint" />
            <mxPoint x="-400" y="1119.29" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="qDMPsKOcjA7EG43ip9Th-84" value="Create" style="shape=trapezoid;perimeter=trapezoidPerimeter;whiteSpace=wrap;fixedSize=1;strokeWidth=2;fontSize=14;fontFamily=Lucida Console;" vertex="1" parent="qDMPsKOcjA7EG43ip9Th-74">
          <mxGeometry x="160" y="440" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="qDMPsKOcjA7EG43ip9Th-85" value="Read" style="shape=trapezoid;perimeter=trapezoidPerimeter;whiteSpace=wrap;fixedSize=1;strokeWidth=2;fontSize=14;fontFamily=Lucida Console;" vertex="1" parent="qDMPsKOcjA7EG43ip9Th-74">
          <mxGeometry y="440" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="qDMPsKOcjA7EG43ip9Th-86" value="Update" style="shape=trapezoid;perimeter=trapezoidPerimeter;whiteSpace=wrap;fixedSize=1;strokeWidth=2;fontSize=14;fontFamily=Lucida Console;" vertex="1" parent="qDMPsKOcjA7EG43ip9Th-74">
          <mxGeometry x="320" y="440" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="qDMPsKOcjA7EG43ip9Th-87" value="Delete" style="shape=trapezoid;perimeter=trapezoidPerimeter;whiteSpace=wrap;fixedSize=1;strokeWidth=2;fontSize=14;fontFamily=Lucida Console;" vertex="1" parent="qDMPsKOcjA7EG43ip9Th-74">
          <mxGeometry x="480" y="440" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="qDMPsKOcjA7EG43ip9Th-96" value="" style="endArrow=classic;html=1;rounded=0;endFill=1;strokeWidth=2;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="qDMPsKOcjA7EG43ip9Th-1" source="qDMPsKOcjA7EG43ip9Th-104" target="qDMPsKOcjA7EG43ip9Th-68">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-1280" y="-600" as="sourcePoint" />
            <mxPoint x="-1830" y="-700" as="targetPoint" />
            <Array as="points">
              <mxPoint x="-1880" y="-540" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="qDMPsKOcjA7EG43ip9Th-97" value="" style="endArrow=classic;html=1;rounded=0;endFill=1;strokeWidth=2;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="qDMPsKOcjA7EG43ip9Th-1" source="qDMPsKOcjA7EG43ip9Th-105" target="qDMPsKOcjA7EG43ip9Th-69">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-1280" y="-600" as="sourcePoint" />
            <mxPoint x="-1980" y="-670" as="targetPoint" />
            <Array as="points">
              <mxPoint x="-1720" y="-500" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="qDMPsKOcjA7EG43ip9Th-98" value="" style="endArrow=classic;html=1;rounded=0;endFill=1;strokeWidth=2;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="qDMPsKOcjA7EG43ip9Th-1" source="qDMPsKOcjA7EG43ip9Th-106" target="qDMPsKOcjA7EG43ip9Th-84">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-1280" y="-600" as="sourcePoint" />
            <mxPoint x="-1970" y="-660" as="targetPoint" />
            <Array as="points">
              <mxPoint x="-840" y="-420" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="qDMPsKOcjA7EG43ip9Th-99" value="" style="endArrow=classic;html=1;rounded=0;endFill=1;strokeWidth=2;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="qDMPsKOcjA7EG43ip9Th-1" source="qDMPsKOcjA7EG43ip9Th-107" target="qDMPsKOcjA7EG43ip9Th-85">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-1280" y="-600" as="sourcePoint" />
            <mxPoint x="-990" y="-750" as="targetPoint" />
            <Array as="points">
              <mxPoint x="-1000" y="-460" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="qDMPsKOcjA7EG43ip9Th-100" value="" style="endArrow=classic;html=1;rounded=0;endFill=1;strokeWidth=2;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="qDMPsKOcjA7EG43ip9Th-1" source="qDMPsKOcjA7EG43ip9Th-108" target="qDMPsKOcjA7EG43ip9Th-86">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-1280" y="-600" as="sourcePoint" />
            <mxPoint x="-970" y="-730" as="targetPoint" />
            <Array as="points">
              <mxPoint x="-680" y="-380" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="qDMPsKOcjA7EG43ip9Th-101" value="" style="endArrow=classic;html=1;rounded=0;endFill=1;strokeWidth=2;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="qDMPsKOcjA7EG43ip9Th-1" source="qDMPsKOcjA7EG43ip9Th-109" target="qDMPsKOcjA7EG43ip9Th-87">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-1280" y="-600" as="sourcePoint" />
            <mxPoint x="-960" y="-720" as="targetPoint" />
            <Array as="points">
              <mxPoint x="-520" y="-340" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="qDMPsKOcjA7EG43ip9Th-102" value="" style="group" vertex="1" connectable="0" parent="qDMPsKOcjA7EG43ip9Th-1">
          <mxGeometry x="-2280" y="-600" width="240" height="320" as="geometry" />
        </mxCell>
        <mxCell id="qDMPsKOcjA7EG43ip9Th-103" value="" style="shape=trapezoid;perimeter=trapezoidPerimeter;whiteSpace=wrap;html=1;fixedSize=1;direction=north;strokeWidth=2;" vertex="1" parent="qDMPsKOcjA7EG43ip9Th-102">
          <mxGeometry width="240" height="320" as="geometry" />
        </mxCell>
        <mxCell id="qDMPsKOcjA7EG43ip9Th-104" value="POST /api/login" style="text;strokeColor=none;fillColor=none;align=right;verticalAlign=middle;rounded=0;fontSize=14;fontFamily=Lucida Console;" vertex="1" parent="qDMPsKOcjA7EG43ip9Th-102">
          <mxGeometry y="40" width="240" height="40" as="geometry" />
        </mxCell>
        <mxCell id="qDMPsKOcjA7EG43ip9Th-105" value="POST /api/logout" style="text;strokeColor=none;fillColor=none;align=right;verticalAlign=middle;rounded=0;fontSize=14;fontFamily=Lucida Console;" vertex="1" parent="qDMPsKOcjA7EG43ip9Th-102">
          <mxGeometry y="80" width="240" height="40" as="geometry" />
        </mxCell>
        <mxCell id="qDMPsKOcjA7EG43ip9Th-106" value="POST /api/account" style="text;strokeColor=none;fillColor=none;align=right;verticalAlign=middle;rounded=0;fontSize=14;fontFamily=Lucida Console;" vertex="1" parent="qDMPsKOcjA7EG43ip9Th-102">
          <mxGeometry y="160" width="240" height="40" as="geometry" />
        </mxCell>
        <mxCell id="qDMPsKOcjA7EG43ip9Th-107" value="GET /api/account" style="text;strokeColor=none;fillColor=none;align=right;verticalAlign=middle;rounded=0;fontSize=14;fontFamily=Lucida Console;" vertex="1" parent="qDMPsKOcjA7EG43ip9Th-102">
          <mxGeometry y="120" width="240" height="40" as="geometry" />
        </mxCell>
        <mxCell id="qDMPsKOcjA7EG43ip9Th-108" value="PUT /api/account" style="text;strokeColor=none;fillColor=none;align=right;verticalAlign=middle;rounded=0;fontSize=14;fontFamily=Lucida Console;" vertex="1" parent="qDMPsKOcjA7EG43ip9Th-102">
          <mxGeometry y="200" width="240" height="40" as="geometry" />
        </mxCell>
        <mxCell id="qDMPsKOcjA7EG43ip9Th-109" value="DELETE /api/account" style="text;strokeColor=none;fillColor=none;align=right;verticalAlign=middle;rounded=0;fontSize=14;fontFamily=Lucida Console;" vertex="1" parent="qDMPsKOcjA7EG43ip9Th-102">
          <mxGeometry y="240" width="240" height="40" as="geometry" />
        </mxCell>
        <mxCell id="qDMPsKOcjA7EG43ip9Th-110" value="" style="endArrow=classic;html=1;rounded=0;endFill=1;strokeWidth=2;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="qDMPsKOcjA7EG43ip9Th-1" source="qDMPsKOcjA7EG43ip9Th-103" target="qDMPsKOcjA7EG43ip9Th-67">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-1580" y="-490" as="sourcePoint" />
            <mxPoint x="-2180" y="-650" as="targetPoint" />
            <Array as="points">
              <mxPoint x="-2160" y="-660" />
              <mxPoint x="-2040" y="-660" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="qDMPsKOcjA7EG43ip9Th-111" value="Client" style="ellipse;shape=cloud;whiteSpace=wrap;strokeWidth=2;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="qDMPsKOcjA7EG43ip9Th-1">
          <mxGeometry x="-2600" y="-520" width="160" height="160" as="geometry" />
        </mxCell>
        <mxCell id="qDMPsKOcjA7EG43ip9Th-112" value="" style="endArrow=none;html=1;rounded=0;exitX=0.875;exitY=0.5;exitDx=0;exitDy=0;exitPerimeter=0;strokeWidth=2;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="qDMPsKOcjA7EG43ip9Th-1" source="qDMPsKOcjA7EG43ip9Th-111" target="qDMPsKOcjA7EG43ip9Th-103">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-2360" y="-210" as="sourcePoint" />
            <mxPoint x="-2320" y="-430" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="qDMPsKOcjA7EG43ip9Th-114" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="qDMPsKOcjA7EG43ip9Th-1" source="qDMPsKOcjA7EG43ip9Th-58" target="qDMPsKOcjA7EG43ip9Th-85">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-2330" y="-990" as="sourcePoint" />
            <mxPoint x="-2280" y="-1040" as="targetPoint" />
            <Array as="points">
              <mxPoint x="-2000" y="-1300" />
              <mxPoint x="-1320" y="-1300" />
              <mxPoint x="-1320" y="-700" />
              <mxPoint x="-1000" y="-700" />
            </Array>
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram name="Credential login flow" id="iiDN2qElIujLYw381Zef">
    <mxGraphModel dx="5714" dy="2691" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="0" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0">
      <root>
        <mxCell id="UG1EmHlHDBgbCyrQQ15M-0" />
        <mxCell id="UG1EmHlHDBgbCyrQQ15M-1" parent="UG1EmHlHDBgbCyrQQ15M-0" />
        <mxCell id="UG1EmHlHDBgbCyrQQ15M-57" value="" style="swimlane;startSize=0;strokeWidth=2;" vertex="1" parent="UG1EmHlHDBgbCyrQQ15M-1">
          <mxGeometry x="-2120" y="-1240" width="720" height="480" as="geometry" />
        </mxCell>
        <mxCell id="UG1EmHlHDBgbCyrQQ15M-58" value="Authentication&#xa;service" style="whiteSpace=wrap;aspect=fixed;strokeWidth=2;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="UG1EmHlHDBgbCyrQQ15M-57">
          <mxGeometry x="40" y="40" width="160" height="160" as="geometry" />
        </mxCell>
        <mxCell id="UG1EmHlHDBgbCyrQQ15M-59" value="PersistentSession&#xa;database" style="rounded=1;whiteSpace=wrap;strokeWidth=2;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="UG1EmHlHDBgbCyrQQ15M-57">
          <mxGeometry x="240" y="40" width="160" height="160" as="geometry" />
        </mxCell>
        <mxCell id="UG1EmHlHDBgbCyrQQ15M-60" value="PersistentSession" style="swimlane;whiteSpace=wrap;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="UG1EmHlHDBgbCyrQQ15M-57">
          <mxGeometry x="440" y="40" width="240" height="280" as="geometry" />
        </mxCell>
        <mxCell id="UG1EmHlHDBgbCyrQQ15M-61" value="ID (string)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="UG1EmHlHDBgbCyrQQ15M-60">
          <mxGeometry x="10" y="40" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="UG1EmHlHDBgbCyrQQ15M-62" value="Creation time (number)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="UG1EmHlHDBgbCyrQQ15M-60">
          <mxGeometry x="10" y="200" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="UG1EmHlHDBgbCyrQQ15M-63" value="Expiration time (number)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="UG1EmHlHDBgbCyrQQ15M-60">
          <mxGeometry x="10" y="240" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="UG1EmHlHDBgbCyrQQ15M-64" value="UserAccount ID (string)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="UG1EmHlHDBgbCyrQQ15M-60">
          <mxGeometry x="10" y="80" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="UG1EmHlHDBgbCyrQQ15M-65" value="Refresh token (string)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="UG1EmHlHDBgbCyrQQ15M-60">
          <mxGeometry x="10" y="160" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="UG1EmHlHDBgbCyrQQ15M-66" value="Roles (bit flags)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="UG1EmHlHDBgbCyrQQ15M-60">
          <mxGeometry x="10" y="120" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="UG1EmHlHDBgbCyrQQ15M-68" value="Login" style="shape=trapezoid;perimeter=trapezoidPerimeter;whiteSpace=wrap;fixedSize=1;strokeWidth=2;fontSize=14;fontFamily=Lucida Console;" vertex="1" parent="UG1EmHlHDBgbCyrQQ15M-57">
          <mxGeometry x="160" y="440" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="UG1EmHlHDBgbCyrQQ15M-70" value="" style="endArrow=none;html=1;rounded=0;strokeWidth=2;entryX=1;entryY=0.5;entryDx=0;entryDy=0;exitX=0;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="UG1EmHlHDBgbCyrQQ15M-57" source="UG1EmHlHDBgbCyrQQ15M-59" target="UG1EmHlHDBgbCyrQQ15M-58">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="300" y="320" as="sourcePoint" />
            <mxPoint x="180" y="300" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="cCqyE-cd34B0lMEnL1Lj-1" value="3. Authentication service checks request body to determine which flow to execute (credential or refresh token login). Credentials are found, so credential login flow starts." style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;fontSize=14;fontFamily=Lucida Console;whiteSpace=wrap;" vertex="1" parent="UG1EmHlHDBgbCyrQQ15M-57">
          <mxGeometry x="40" y="200" width="160" height="160" as="geometry" />
        </mxCell>
        <mxCell id="cCqyE-cd34B0lMEnL1Lj-3" value="5. If UserAccount query is successful, Authentication service takes password from request body, concatenates salt from UserAccount, and hashes it. Result is compared with hash from UserAccount.&#xa;If they don&#39;t match, Authentication service responds to client with failure to authenticate (401).&#xa;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;fontSize=14;fontFamily=Lucida Console;whiteSpace=wrap;" vertex="1" parent="UG1EmHlHDBgbCyrQQ15M-57">
          <mxGeometry x="240" y="200" width="160" height="240" as="geometry" />
        </mxCell>
        <mxCell id="cCqyE-cd34B0lMEnL1Lj-4" value="6. If hashes match, Authentication service generates unique refresh token and PersistentSession entry. ID token (JWT) is generated with PersistentSession ID and creation time (current time) embedded in the payload." style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;fontSize=14;fontFamily=Lucida Console;whiteSpace=wrap;" vertex="1" parent="UG1EmHlHDBgbCyrQQ15M-57">
          <mxGeometry x="440" y="320" width="240" height="120" as="geometry" />
        </mxCell>
        <mxCell id="UG1EmHlHDBgbCyrQQ15M-74" value="" style="swimlane;startSize=0;strokeWidth=2;" vertex="1" parent="UG1EmHlHDBgbCyrQQ15M-1">
          <mxGeometry x="-1080" y="-1240" width="800" height="480" as="geometry" />
        </mxCell>
        <mxCell id="UG1EmHlHDBgbCyrQQ15M-75" value="UserAccount&#xa;service" style="whiteSpace=wrap;aspect=fixed;strokeWidth=2;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="UG1EmHlHDBgbCyrQQ15M-74">
          <mxGeometry x="40" y="40" width="160" height="160" as="geometry" />
        </mxCell>
        <mxCell id="UG1EmHlHDBgbCyrQQ15M-76" value="UserAccount&#xa;database" style="rounded=1;whiteSpace=wrap;strokeWidth=2;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="UG1EmHlHDBgbCyrQQ15M-74">
          <mxGeometry x="240" y="40" width="160" height="160" as="geometry" />
        </mxCell>
        <mxCell id="UG1EmHlHDBgbCyrQQ15M-77" value="UserAccount" style="swimlane;whiteSpace=wrap;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="UG1EmHlHDBgbCyrQQ15M-74">
          <mxGeometry x="440" y="40" width="240" height="240" as="geometry" />
        </mxCell>
        <mxCell id="UG1EmHlHDBgbCyrQQ15M-78" value="ID (string)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="UG1EmHlHDBgbCyrQQ15M-77">
          <mxGeometry x="10" y="40" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="UG1EmHlHDBgbCyrQQ15M-79" value="Password salt (string)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="UG1EmHlHDBgbCyrQQ15M-77">
          <mxGeometry x="10" y="160" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="UG1EmHlHDBgbCyrQQ15M-80" value="Name (string)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="UG1EmHlHDBgbCyrQQ15M-77">
          <mxGeometry x="10" y="80" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="UG1EmHlHDBgbCyrQQ15M-81" value="Password hash (string)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="UG1EmHlHDBgbCyrQQ15M-77">
          <mxGeometry x="10" y="120" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="UG1EmHlHDBgbCyrQQ15M-82" value="Roles (bit flags)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="UG1EmHlHDBgbCyrQQ15M-77">
          <mxGeometry x="10" y="200" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="UG1EmHlHDBgbCyrQQ15M-83" value="" style="endArrow=none;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;" edge="1" parent="UG1EmHlHDBgbCyrQQ15M-74" source="UG1EmHlHDBgbCyrQQ15M-75" target="UG1EmHlHDBgbCyrQQ15M-76">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-560" y="1119.29" as="sourcePoint" />
            <mxPoint x="-400" y="1119.29" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="UG1EmHlHDBgbCyrQQ15M-85" value="Read" style="shape=trapezoid;perimeter=trapezoidPerimeter;whiteSpace=wrap;fixedSize=1;strokeWidth=2;fontSize=14;fontFamily=Lucida Console;" vertex="1" parent="UG1EmHlHDBgbCyrQQ15M-74">
          <mxGeometry y="440" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="UG1EmHlHDBgbCyrQQ15M-96" value="" style="endArrow=classic;html=1;rounded=0;endFill=1;strokeWidth=2;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="UG1EmHlHDBgbCyrQQ15M-1" source="UG1EmHlHDBgbCyrQQ15M-104" target="UG1EmHlHDBgbCyrQQ15M-68">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-1280" y="-600" as="sourcePoint" />
            <mxPoint x="-1830" y="-700" as="targetPoint" />
            <Array as="points">
              <mxPoint x="-1880" y="-540" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="UG1EmHlHDBgbCyrQQ15M-102" value="" style="group" vertex="1" connectable="0" parent="UG1EmHlHDBgbCyrQQ15M-1">
          <mxGeometry x="-2280" y="-600" width="240" height="320" as="geometry" />
        </mxCell>
        <mxCell id="UG1EmHlHDBgbCyrQQ15M-103" value="" style="shape=trapezoid;perimeter=trapezoidPerimeter;whiteSpace=wrap;html=1;fixedSize=1;direction=north;strokeWidth=2;" vertex="1" parent="UG1EmHlHDBgbCyrQQ15M-102">
          <mxGeometry width="240" height="320" as="geometry" />
        </mxCell>
        <mxCell id="UG1EmHlHDBgbCyrQQ15M-104" value="POST /api/login" style="text;strokeColor=none;fillColor=none;align=right;verticalAlign=middle;rounded=0;fontSize=14;fontFamily=Lucida Console;" vertex="1" parent="UG1EmHlHDBgbCyrQQ15M-102">
          <mxGeometry y="40" width="240" height="40" as="geometry" />
        </mxCell>
        <mxCell id="UG1EmHlHDBgbCyrQQ15M-111" value="Client" style="ellipse;shape=cloud;whiteSpace=wrap;strokeWidth=2;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="UG1EmHlHDBgbCyrQQ15M-1">
          <mxGeometry x="-2600" y="-520" width="160" height="160" as="geometry" />
        </mxCell>
        <mxCell id="UG1EmHlHDBgbCyrQQ15M-112" value="" style="endArrow=none;html=1;rounded=0;exitX=0.875;exitY=0.5;exitDx=0;exitDy=0;exitPerimeter=0;strokeWidth=2;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="UG1EmHlHDBgbCyrQQ15M-1" source="UG1EmHlHDBgbCyrQQ15M-111" target="UG1EmHlHDBgbCyrQQ15M-103">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-2360" y="-210" as="sourcePoint" />
            <mxPoint x="-2320" y="-430" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="UG1EmHlHDBgbCyrQQ15M-114" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="UG1EmHlHDBgbCyrQQ15M-1" source="UG1EmHlHDBgbCyrQQ15M-58" target="UG1EmHlHDBgbCyrQQ15M-85">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-2330" y="-990" as="sourcePoint" />
            <mxPoint x="-2280" y="-1040" as="targetPoint" />
            <Array as="points">
              <mxPoint x="-2000" y="-1300" />
              <mxPoint x="-1320" y="-1300" />
              <mxPoint x="-1320" y="-700" />
              <mxPoint x="-1000" y="-700" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="UG1EmHlHDBgbCyrQQ15M-116" value="1. Client makes POST request to /api/login. Body contains credentials (username and password)." style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;fontSize=14;fontFamily=Lucida Console;whiteSpace=wrap;" vertex="1" parent="UG1EmHlHDBgbCyrQQ15M-1">
          <mxGeometry x="-2440" y="-560" width="160" height="80" as="geometry" />
        </mxCell>
        <mxCell id="cCqyE-cd34B0lMEnL1Lj-0" value="2. Gateway forwards request to Authentication service." style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;fontSize=14;fontFamily=Lucida Console;whiteSpace=wrap;" vertex="1" parent="UG1EmHlHDBgbCyrQQ15M-1">
          <mxGeometry x="-2040" y="-680" width="160" height="80" as="geometry" />
        </mxCell>
        <mxCell id="cCqyE-cd34B0lMEnL1Lj-2" value="4. Authentication service invokes UserAccount service to fetch UserAccount. Username in request body is used to query via name. System role is used in order to prevent UserAccount service from erasing password hash and salt from returned UserAccount.&#xa;If no UserAccount exists with given username, Authentication service responds to client with failure to authenticate (401)." style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;fontSize=14;fontFamily=Lucida Console;whiteSpace=wrap;" vertex="1" parent="UG1EmHlHDBgbCyrQQ15M-1">
          <mxGeometry x="-2240" y="-1440" width="240" height="200" as="geometry" />
        </mxCell>
        <mxCell id="cCqyE-cd34B0lMEnL1Lj-5" value="7. Authentication service responds to client with success (200), embedding refresh token and ID token in body." style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;fontSize=14;fontFamily=Lucida Console;whiteSpace=wrap;" vertex="1" parent="UG1EmHlHDBgbCyrQQ15M-1">
          <mxGeometry x="-1840" y="-680" width="160" height="120" as="geometry" />
        </mxCell>
        <mxCell id="ZfNuMjK6ifV1Dfrw5RZr-0" value="ID token (JWT)" style="swimlane;whiteSpace=wrap;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="UG1EmHlHDBgbCyrQQ15M-1">
          <mxGeometry x="-1640" y="-720" width="240" height="160" as="geometry" />
        </mxCell>
        <mxCell id="ZfNuMjK6ifV1Dfrw5RZr-1" value="PersistentSession ID" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="ZfNuMjK6ifV1Dfrw5RZr-0">
          <mxGeometry x="10" y="40" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="ZfNuMjK6ifV1Dfrw5RZr-2" value="Expiration time" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="ZfNuMjK6ifV1Dfrw5RZr-0">
          <mxGeometry x="10" y="80" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="ZfNuMjK6ifV1Dfrw5RZr-3" value="Signature" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="ZfNuMjK6ifV1Dfrw5RZr-0">
          <mxGeometry x="10" y="120" width="220" height="40" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram name="Refresh token login flow" id="xbDOTIuYTRdpLwBqfV0a">
    <mxGraphModel dx="5714" dy="2691" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="0" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0">
      <root>
        <mxCell id="OXrQHqzUpKWjyLf83tkL-0" />
        <mxCell id="OXrQHqzUpKWjyLf83tkL-1" parent="OXrQHqzUpKWjyLf83tkL-0" />
        <mxCell id="OXrQHqzUpKWjyLf83tkL-2" value="" style="swimlane;startSize=0;strokeWidth=2;" vertex="1" parent="OXrQHqzUpKWjyLf83tkL-1">
          <mxGeometry x="-2120" y="-1240" width="720" height="480" as="geometry" />
        </mxCell>
        <mxCell id="OXrQHqzUpKWjyLf83tkL-3" value="Authentication&#xa;service" style="whiteSpace=wrap;aspect=fixed;strokeWidth=2;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="OXrQHqzUpKWjyLf83tkL-2">
          <mxGeometry x="40" y="40" width="160" height="160" as="geometry" />
        </mxCell>
        <mxCell id="OXrQHqzUpKWjyLf83tkL-4" value="PersistentSession&#xa;database" style="rounded=1;whiteSpace=wrap;strokeWidth=2;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="OXrQHqzUpKWjyLf83tkL-2">
          <mxGeometry x="240" y="40" width="160" height="160" as="geometry" />
        </mxCell>
        <mxCell id="OXrQHqzUpKWjyLf83tkL-5" value="PersistentSession" style="swimlane;whiteSpace=wrap;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="OXrQHqzUpKWjyLf83tkL-2">
          <mxGeometry x="440" y="40" width="240" height="280" as="geometry" />
        </mxCell>
        <mxCell id="OXrQHqzUpKWjyLf83tkL-6" value="ID (string)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="OXrQHqzUpKWjyLf83tkL-5">
          <mxGeometry x="10" y="40" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OXrQHqzUpKWjyLf83tkL-7" value="Creation time (number)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="OXrQHqzUpKWjyLf83tkL-5">
          <mxGeometry x="10" y="200" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OXrQHqzUpKWjyLf83tkL-8" value="Expiration time (number)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="OXrQHqzUpKWjyLf83tkL-5">
          <mxGeometry x="10" y="240" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OXrQHqzUpKWjyLf83tkL-9" value="UserAccount ID (string)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="OXrQHqzUpKWjyLf83tkL-5">
          <mxGeometry x="10" y="80" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OXrQHqzUpKWjyLf83tkL-10" value="Refresh token (string)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="OXrQHqzUpKWjyLf83tkL-5">
          <mxGeometry x="10" y="160" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OXrQHqzUpKWjyLf83tkL-11" value="Roles (bit flags)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="OXrQHqzUpKWjyLf83tkL-5">
          <mxGeometry x="10" y="120" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OXrQHqzUpKWjyLf83tkL-12" value="Login" style="shape=trapezoid;perimeter=trapezoidPerimeter;whiteSpace=wrap;fixedSize=1;strokeWidth=2;fontSize=14;fontFamily=Lucida Console;" vertex="1" parent="OXrQHqzUpKWjyLf83tkL-2">
          <mxGeometry x="160" y="440" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OXrQHqzUpKWjyLf83tkL-13" value="" style="endArrow=none;html=1;rounded=0;strokeWidth=2;entryX=1;entryY=0.5;entryDx=0;entryDy=0;exitX=0;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="OXrQHqzUpKWjyLf83tkL-2" source="OXrQHqzUpKWjyLf83tkL-4" target="OXrQHqzUpKWjyLf83tkL-3">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="300" y="320" as="sourcePoint" />
            <mxPoint x="180" y="300" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="OXrQHqzUpKWjyLf83tkL-14" value="3. Authentication service checks request body to determine which flow to execute (credential or refresh token login). Refresh token is found, so refresh token flow starts." style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;fontSize=14;fontFamily=Lucida Console;whiteSpace=wrap;" vertex="1" parent="OXrQHqzUpKWjyLf83tkL-2">
          <mxGeometry x="40" y="200" width="160" height="160" as="geometry" />
        </mxCell>
        <mxCell id="OXrQHqzUpKWjyLf83tkL-15" value="4. Authentication service uses refresh token in request body to query database for PersistentSession. If no match is found or match is expired, Authentication service responds to client with failure to authenticate (401)." style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;fontSize=14;fontFamily=Lucida Console;whiteSpace=wrap;" vertex="1" parent="OXrQHqzUpKWjyLf83tkL-2">
          <mxGeometry x="240" y="200" width="160" height="200" as="geometry" />
        </mxCell>
        <mxCell id="OXrQHqzUpKWjyLf83tkL-16" value="5. If match is found, Authentication service generates ID token (JWT) with PersistentSession ID and creation time embedded in the payload." style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;fontSize=14;fontFamily=Lucida Console;whiteSpace=wrap;" vertex="1" parent="OXrQHqzUpKWjyLf83tkL-2">
          <mxGeometry x="440" y="320" width="240" height="80" as="geometry" />
        </mxCell>
        <mxCell id="OXrQHqzUpKWjyLf83tkL-28" value="" style="endArrow=classic;html=1;rounded=0;endFill=1;strokeWidth=2;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="OXrQHqzUpKWjyLf83tkL-1" source="OXrQHqzUpKWjyLf83tkL-31" target="OXrQHqzUpKWjyLf83tkL-12">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-1280" y="-600" as="sourcePoint" />
            <mxPoint x="-1830" y="-700" as="targetPoint" />
            <Array as="points">
              <mxPoint x="-1880" y="-540" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="OXrQHqzUpKWjyLf83tkL-29" value="" style="group" vertex="1" connectable="0" parent="OXrQHqzUpKWjyLf83tkL-1">
          <mxGeometry x="-2280" y="-600" width="240" height="320" as="geometry" />
        </mxCell>
        <mxCell id="OXrQHqzUpKWjyLf83tkL-30" value="" style="shape=trapezoid;perimeter=trapezoidPerimeter;whiteSpace=wrap;html=1;fixedSize=1;direction=north;strokeWidth=2;" vertex="1" parent="OXrQHqzUpKWjyLf83tkL-29">
          <mxGeometry width="240" height="320" as="geometry" />
        </mxCell>
        <mxCell id="OXrQHqzUpKWjyLf83tkL-31" value="POST /api/login" style="text;strokeColor=none;fillColor=none;align=right;verticalAlign=middle;rounded=0;fontSize=14;fontFamily=Lucida Console;" vertex="1" parent="OXrQHqzUpKWjyLf83tkL-29">
          <mxGeometry y="40" width="240" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OXrQHqzUpKWjyLf83tkL-32" value="Client" style="ellipse;shape=cloud;whiteSpace=wrap;strokeWidth=2;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="OXrQHqzUpKWjyLf83tkL-1">
          <mxGeometry x="-2600" y="-520" width="160" height="160" as="geometry" />
        </mxCell>
        <mxCell id="OXrQHqzUpKWjyLf83tkL-33" value="" style="endArrow=none;html=1;rounded=0;exitX=0.875;exitY=0.5;exitDx=0;exitDy=0;exitPerimeter=0;strokeWidth=2;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="OXrQHqzUpKWjyLf83tkL-1" source="OXrQHqzUpKWjyLf83tkL-32" target="OXrQHqzUpKWjyLf83tkL-30">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-2360" y="-210" as="sourcePoint" />
            <mxPoint x="-2320" y="-430" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="OXrQHqzUpKWjyLf83tkL-35" value="1. Client makes POST request to /api/login. Body contains refresh token." style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;fontSize=14;fontFamily=Lucida Console;whiteSpace=wrap;" vertex="1" parent="OXrQHqzUpKWjyLf83tkL-1">
          <mxGeometry x="-2440" y="-560" width="160" height="80" as="geometry" />
        </mxCell>
        <mxCell id="OXrQHqzUpKWjyLf83tkL-36" value="2. Gateway forwards request to Authentication service." style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;fontSize=14;fontFamily=Lucida Console;whiteSpace=wrap;" vertex="1" parent="OXrQHqzUpKWjyLf83tkL-1">
          <mxGeometry x="-2040" y="-680" width="160" height="80" as="geometry" />
        </mxCell>
        <mxCell id="OXrQHqzUpKWjyLf83tkL-38" value="6. Authentication service responds to client with success (200), embedding ID token in body." style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;fontSize=14;fontFamily=Lucida Console;whiteSpace=wrap;" vertex="1" parent="OXrQHqzUpKWjyLf83tkL-1">
          <mxGeometry x="-1840" y="-680" width="160" height="80" as="geometry" />
        </mxCell>
        <mxCell id="gxcSMOFSQyk6c_54DUwV-0" value="ID token (JWT)" style="swimlane;whiteSpace=wrap;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="OXrQHqzUpKWjyLf83tkL-1">
          <mxGeometry x="-1640" y="-720" width="240" height="160" as="geometry" />
        </mxCell>
        <mxCell id="gxcSMOFSQyk6c_54DUwV-1" value="PersistentSession ID" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="gxcSMOFSQyk6c_54DUwV-0">
          <mxGeometry x="10" y="40" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="gxcSMOFSQyk6c_54DUwV-2" value="Expiration time" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="gxcSMOFSQyk6c_54DUwV-0">
          <mxGeometry x="10" y="80" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="gxcSMOFSQyk6c_54DUwV-3" value="Signature" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="gxcSMOFSQyk6c_54DUwV-0">
          <mxGeometry x="10" y="120" width="220" height="40" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram name="Logout flow" id="jgXbx4AO5rVkzb-taIK5">
    <mxGraphModel dx="5542" dy="2627" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="0" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0">
      <root>
        <mxCell id="2vpscnXJKijw0ex7J8Is-0" />
        <mxCell id="2vpscnXJKijw0ex7J8Is-1" parent="2vpscnXJKijw0ex7J8Is-0" />
        <mxCell id="2vpscnXJKijw0ex7J8Is-2" value="" style="swimlane;startSize=0;strokeWidth=2;" vertex="1" parent="2vpscnXJKijw0ex7J8Is-1">
          <mxGeometry x="-2120" y="-1240" width="720" height="480" as="geometry" />
        </mxCell>
        <mxCell id="2vpscnXJKijw0ex7J8Is-3" value="Authentication&#xa;service" style="whiteSpace=wrap;aspect=fixed;strokeWidth=2;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="2vpscnXJKijw0ex7J8Is-2">
          <mxGeometry x="40" y="40" width="160" height="160" as="geometry" />
        </mxCell>
        <mxCell id="2vpscnXJKijw0ex7J8Is-4" value="PersistentSession&#xa;database" style="rounded=1;whiteSpace=wrap;strokeWidth=2;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="2vpscnXJKijw0ex7J8Is-2">
          <mxGeometry x="240" y="40" width="160" height="160" as="geometry" />
        </mxCell>
        <mxCell id="2vpscnXJKijw0ex7J8Is-5" value="PersistentSession" style="swimlane;whiteSpace=wrap;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="2vpscnXJKijw0ex7J8Is-2">
          <mxGeometry x="440" y="40" width="240" height="280" as="geometry" />
        </mxCell>
        <mxCell id="2vpscnXJKijw0ex7J8Is-6" value="ID (string)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="2vpscnXJKijw0ex7J8Is-5">
          <mxGeometry x="10" y="40" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="2vpscnXJKijw0ex7J8Is-7" value="Creation time (number)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="2vpscnXJKijw0ex7J8Is-5">
          <mxGeometry x="10" y="200" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="2vpscnXJKijw0ex7J8Is-8" value="Expiration time (number)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="2vpscnXJKijw0ex7J8Is-5">
          <mxGeometry x="10" y="240" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="2vpscnXJKijw0ex7J8Is-9" value="UserAccount ID (string)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="2vpscnXJKijw0ex7J8Is-5">
          <mxGeometry x="10" y="80" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="2vpscnXJKijw0ex7J8Is-10" value="Refresh token (string)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="2vpscnXJKijw0ex7J8Is-5">
          <mxGeometry x="10" y="160" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="2vpscnXJKijw0ex7J8Is-11" value="Roles (bit flags)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="2vpscnXJKijw0ex7J8Is-5">
          <mxGeometry x="10" y="120" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="2vpscnXJKijw0ex7J8Is-12" value="Logout" style="shape=trapezoid;perimeter=trapezoidPerimeter;whiteSpace=wrap;fixedSize=1;strokeWidth=2;fontSize=14;fontFamily=Lucida Console;" vertex="1" parent="2vpscnXJKijw0ex7J8Is-2">
          <mxGeometry x="320" y="440" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="2vpscnXJKijw0ex7J8Is-13" value="" style="endArrow=none;html=1;rounded=0;strokeWidth=2;entryX=1;entryY=0.5;entryDx=0;entryDy=0;exitX=0;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="2vpscnXJKijw0ex7J8Is-2" source="2vpscnXJKijw0ex7J8Is-4" target="2vpscnXJKijw0ex7J8Is-3">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="300" y="320" as="sourcePoint" />
            <mxPoint x="180" y="300" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="2vpscnXJKijw0ex7J8Is-14" value="3. Authentication service uses refresh token from request body to delete any matching PersistentSession entry from database." style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;fontSize=14;fontFamily=Lucida Console;whiteSpace=wrap;" vertex="1" parent="2vpscnXJKijw0ex7J8Is-2">
          <mxGeometry x="240" y="200" width="160" height="120" as="geometry" />
        </mxCell>
        <mxCell id="2vpscnXJKijw0ex7J8Is-17" value="" style="group" vertex="1" connectable="0" parent="2vpscnXJKijw0ex7J8Is-1">
          <mxGeometry x="-2280" y="-600" width="240" height="320" as="geometry" />
        </mxCell>
        <mxCell id="2vpscnXJKijw0ex7J8Is-18" value="" style="shape=trapezoid;perimeter=trapezoidPerimeter;whiteSpace=wrap;html=1;fixedSize=1;direction=north;strokeWidth=2;" vertex="1" parent="2vpscnXJKijw0ex7J8Is-17">
          <mxGeometry width="240" height="320" as="geometry" />
        </mxCell>
        <mxCell id="2vpscnXJKijw0ex7J8Is-19" value="POST /api/logout" style="text;strokeColor=none;fillColor=none;align=right;verticalAlign=middle;rounded=0;fontSize=14;fontFamily=Lucida Console;" vertex="1" parent="2vpscnXJKijw0ex7J8Is-17">
          <mxGeometry y="80" width="240" height="40" as="geometry" />
        </mxCell>
        <mxCell id="2vpscnXJKijw0ex7J8Is-22" value="" style="endArrow=classic;html=1;rounded=0;endFill=1;strokeWidth=2;entryX=0.5;entryY=1;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="2vpscnXJKijw0ex7J8Is-1" source="2vpscnXJKijw0ex7J8Is-19" target="2vpscnXJKijw0ex7J8Is-12">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-1920" y="-560" as="sourcePoint" />
            <mxPoint x="-2180" y="-650" as="targetPoint" />
            <Array as="points">
              <mxPoint x="-1720" y="-500" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="2vpscnXJKijw0ex7J8Is-23" value="Client" style="ellipse;shape=cloud;whiteSpace=wrap;strokeWidth=2;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="2vpscnXJKijw0ex7J8Is-1">
          <mxGeometry x="-2600" y="-520" width="160" height="160" as="geometry" />
        </mxCell>
        <mxCell id="2vpscnXJKijw0ex7J8Is-24" value="" style="endArrow=none;html=1;rounded=0;exitX=0.875;exitY=0.5;exitDx=0;exitDy=0;exitPerimeter=0;strokeWidth=2;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="2vpscnXJKijw0ex7J8Is-1" source="2vpscnXJKijw0ex7J8Is-23" target="2vpscnXJKijw0ex7J8Is-18">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-2360" y="-210" as="sourcePoint" />
            <mxPoint x="-2320" y="-430" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="2vpscnXJKijw0ex7J8Is-25" value="1. Client makes POST request to /api/logout. Body contains refresh token." style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;fontSize=14;fontFamily=Lucida Console;whiteSpace=wrap;" vertex="1" parent="2vpscnXJKijw0ex7J8Is-1">
          <mxGeometry x="-2440" y="-560" width="160" height="80" as="geometry" />
        </mxCell>
        <mxCell id="ny6IwFlw-l-67ikgddU9-0" value="2. Gateway forwards request to Authentication service." style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;fontSize=14;fontFamily=Lucida Console;whiteSpace=wrap;" vertex="1" parent="2vpscnXJKijw0ex7J8Is-1">
          <mxGeometry x="-1880" y="-680" width="160" height="80" as="geometry" />
        </mxCell>
        <mxCell id="2vpscnXJKijw0ex7J8Is-15" value="4. Authentication service responds with success (200)." style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;fontSize=14;fontFamily=Lucida Console;whiteSpace=wrap;" vertex="1" parent="2vpscnXJKijw0ex7J8Is-1">
          <mxGeometry x="-1680" y="-680" width="160" height="80" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram name="Identification flow" id="TeRlo1v7nFw9AYqGBeiY">
    <mxGraphModel dx="5542" dy="2627" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="0" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0">
      <root>
        <mxCell id="38_CK97VerlgJTxG9D-F-0" />
        <mxCell id="38_CK97VerlgJTxG9D-F-1" parent="38_CK97VerlgJTxG9D-F-0" />
        <mxCell id="38_CK97VerlgJTxG9D-F-57" value="" style="swimlane;startSize=0;strokeWidth=2;" vertex="1" parent="38_CK97VerlgJTxG9D-F-1">
          <mxGeometry x="-2120" y="-1240" width="720" height="480" as="geometry" />
        </mxCell>
        <mxCell id="38_CK97VerlgJTxG9D-F-58" value="Authentication&#xa;service" style="whiteSpace=wrap;aspect=fixed;strokeWidth=2;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="38_CK97VerlgJTxG9D-F-57">
          <mxGeometry x="40" y="40" width="160" height="160" as="geometry" />
        </mxCell>
        <mxCell id="38_CK97VerlgJTxG9D-F-59" value="PersistentSession&#xa;database" style="rounded=1;whiteSpace=wrap;strokeWidth=2;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="38_CK97VerlgJTxG9D-F-57">
          <mxGeometry x="240" y="40" width="160" height="160" as="geometry" />
        </mxCell>
        <mxCell id="38_CK97VerlgJTxG9D-F-60" value="PersistentSession" style="swimlane;whiteSpace=wrap;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="38_CK97VerlgJTxG9D-F-57">
          <mxGeometry x="440" y="40" width="240" height="280" as="geometry" />
        </mxCell>
        <mxCell id="38_CK97VerlgJTxG9D-F-61" value="ID (string)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="38_CK97VerlgJTxG9D-F-60">
          <mxGeometry x="10" y="40" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="38_CK97VerlgJTxG9D-F-62" value="Creation time (number)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="38_CK97VerlgJTxG9D-F-60">
          <mxGeometry x="10" y="200" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="38_CK97VerlgJTxG9D-F-63" value="Expiration time (number)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="38_CK97VerlgJTxG9D-F-60">
          <mxGeometry x="10" y="240" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="38_CK97VerlgJTxG9D-F-64" value="UserAccount ID (string)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="38_CK97VerlgJTxG9D-F-60">
          <mxGeometry x="10" y="80" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="38_CK97VerlgJTxG9D-F-65" value="Refresh token (string)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="38_CK97VerlgJTxG9D-F-60">
          <mxGeometry x="10" y="160" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="38_CK97VerlgJTxG9D-F-66" value="Roles (bit flags)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="38_CK97VerlgJTxG9D-F-60">
          <mxGeometry x="10" y="120" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="38_CK97VerlgJTxG9D-F-67" value="Identify" style="shape=trapezoid;perimeter=trapezoidPerimeter;whiteSpace=wrap;fixedSize=1;strokeWidth=2;fontSize=14;fontFamily=Lucida Console;" vertex="1" parent="38_CK97VerlgJTxG9D-F-57">
          <mxGeometry y="440" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="38_CK97VerlgJTxG9D-F-70" value="" style="endArrow=none;html=1;rounded=0;strokeWidth=2;entryX=1;entryY=0.5;entryDx=0;entryDy=0;exitX=0;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="38_CK97VerlgJTxG9D-F-57" source="38_CK97VerlgJTxG9D-F-59" target="38_CK97VerlgJTxG9D-F-58">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="300" y="320" as="sourcePoint" />
            <mxPoint x="180" y="300" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="38_CK97VerlgJTxG9D-F-71" value="3. Authentication service extracts ID token (JWT) from request&#39;s authorization header. Token is verified via standard JWT procedures. Service extracts PersistentSession ID.&#xa;If request does not contain token or verification fails, empty authority object is generated and returned to gateway." style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;fontSize=14;fontFamily=Lucida Console;whiteSpace=wrap;" vertex="1" parent="38_CK97VerlgJTxG9D-F-57">
          <mxGeometry x="40" y="200" width="160" height="240" as="geometry" />
        </mxCell>
        <mxCell id="38_CK97VerlgJTxG9D-F-72" value="4. Authentication service uses extracted ID to fetch PersistentSession from database. If no entry is found or entry is expired, ID token is considered as invalid and empty authority object is returned to gateway." style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;fontSize=14;fontFamily=Lucida Console;whiteSpace=wrap;" vertex="1" parent="38_CK97VerlgJTxG9D-F-57">
          <mxGeometry x="240" y="200" width="160" height="160" as="geometry" />
        </mxCell>
        <mxCell id="38_CK97VerlgJTxG9D-F-73" value="5. Authentication service uses UserAccount ID, roles, and creation time (equivalent to login time) of PersistentSession to construct authority object." style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;fontSize=14;fontFamily=Lucida Console;whiteSpace=wrap;" vertex="1" parent="38_CK97VerlgJTxG9D-F-57">
          <mxGeometry x="240" y="360" width="240" height="120" as="geometry" />
        </mxCell>
        <mxCell id="38_CK97VerlgJTxG9D-F-102" value="" style="group" vertex="1" connectable="0" parent="38_CK97VerlgJTxG9D-F-1">
          <mxGeometry x="-2280" y="-600" width="240" height="320" as="geometry" />
        </mxCell>
        <mxCell id="38_CK97VerlgJTxG9D-F-103" value="" style="shape=trapezoid;perimeter=trapezoidPerimeter;whiteSpace=wrap;html=1;fixedSize=1;direction=north;strokeWidth=2;" vertex="1" parent="38_CK97VerlgJTxG9D-F-102">
          <mxGeometry width="240" height="320" as="geometry" />
        </mxCell>
        <mxCell id="38_CK97VerlgJTxG9D-F-104" value="Endpoint 1" style="text;strokeColor=none;fillColor=none;align=right;verticalAlign=middle;rounded=0;fontSize=14;fontFamily=Lucida Console;" vertex="1" parent="38_CK97VerlgJTxG9D-F-102">
          <mxGeometry y="40" width="240" height="40" as="geometry" />
        </mxCell>
        <mxCell id="nPXFv-sAKoIW4EJ21AgX-0" value="Endpoint 2" style="text;strokeColor=none;fillColor=none;align=right;verticalAlign=middle;rounded=0;fontSize=14;fontFamily=Lucida Console;" vertex="1" parent="38_CK97VerlgJTxG9D-F-102">
          <mxGeometry y="80" width="240" height="40" as="geometry" />
        </mxCell>
        <mxCell id="nPXFv-sAKoIW4EJ21AgX-2" value="Endpoint N" style="text;strokeColor=none;fillColor=none;align=right;verticalAlign=middle;rounded=0;fontSize=14;fontFamily=Lucida Console;" vertex="1" parent="38_CK97VerlgJTxG9D-F-102">
          <mxGeometry y="240" width="240" height="40" as="geometry" />
        </mxCell>
        <mxCell id="38_CK97VerlgJTxG9D-F-110" value="" style="endArrow=classic;html=1;rounded=0;endFill=1;strokeWidth=2;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="38_CK97VerlgJTxG9D-F-1" source="38_CK97VerlgJTxG9D-F-103" target="38_CK97VerlgJTxG9D-F-67">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-1580" y="-490" as="sourcePoint" />
            <mxPoint x="-2180" y="-650" as="targetPoint" />
            <Array as="points">
              <mxPoint x="-2160" y="-660" />
              <mxPoint x="-2040" y="-660" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="38_CK97VerlgJTxG9D-F-111" value="Client" style="ellipse;shape=cloud;whiteSpace=wrap;strokeWidth=2;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="38_CK97VerlgJTxG9D-F-1">
          <mxGeometry x="-2600" y="-520" width="160" height="160" as="geometry" />
        </mxCell>
        <mxCell id="38_CK97VerlgJTxG9D-F-112" value="" style="endArrow=none;html=1;rounded=0;exitX=0.875;exitY=0.5;exitDx=0;exitDy=0;exitPerimeter=0;strokeWidth=2;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="38_CK97VerlgJTxG9D-F-1" source="38_CK97VerlgJTxG9D-F-111" target="38_CK97VerlgJTxG9D-F-103">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-2360" y="-210" as="sourcePoint" />
            <mxPoint x="-2320" y="-430" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="38_CK97VerlgJTxG9D-F-116" value="1. Client makes any HTTP request." style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;fontSize=14;fontFamily=Lucida Console;whiteSpace=wrap;" vertex="1" parent="38_CK97VerlgJTxG9D-F-1">
          <mxGeometry x="-2440" y="-520" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="38_CK97VerlgJTxG9D-F-117" value="2. Gateway forwards request to Authentication service for client identification." style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;fontSize=14;fontFamily=Lucida Console;whiteSpace=wrap;" vertex="1" parent="38_CK97VerlgJTxG9D-F-1">
          <mxGeometry x="-2320" y="-680" width="160" height="80" as="geometry" />
        </mxCell>
        <mxCell id="38_CK97VerlgJTxG9D-F-118" value="6. Authentication service returns authority object to gateway." style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;fontSize=14;fontFamily=Lucida Console;whiteSpace=wrap;" vertex="1" parent="38_CK97VerlgJTxG9D-F-1">
          <mxGeometry x="-2000" y="-720" width="160" height="80" as="geometry" />
        </mxCell>
        <mxCell id="38_CK97VerlgJTxG9D-F-119" value="7. Gateway forwards original request with authority object to original destination." style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;fontSize=14;fontFamily=Lucida Console;whiteSpace=wrap;" vertex="1" parent="38_CK97VerlgJTxG9D-F-1">
          <mxGeometry x="-2000" y="-640" width="160" height="80" as="geometry" />
        </mxCell>
        <mxCell id="nPXFv-sAKoIW4EJ21AgX-3" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="38_CK97VerlgJTxG9D-F-1" source="38_CK97VerlgJTxG9D-F-104">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-1990" y="-540" as="sourcePoint" />
            <mxPoint x="-1520" y="-540" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="nPXFv-sAKoIW4EJ21AgX-4" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="38_CK97VerlgJTxG9D-F-1" source="nPXFv-sAKoIW4EJ21AgX-0">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-1910" y="-470" as="sourcePoint" />
            <mxPoint x="-1520" y="-500" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="nPXFv-sAKoIW4EJ21AgX-5" value="" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="38_CK97VerlgJTxG9D-F-1" source="nPXFv-sAKoIW4EJ21AgX-2">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-2010" y="-340" as="sourcePoint" />
            <mxPoint x="-1520" y="-340" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="nPXFv-sAKoIW4EJ21AgX-6" value="8. Service uses authority object to determine whether client is authorized to execute request." style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;fontSize=14;fontFamily=Lucida Console;whiteSpace=wrap;" vertex="1" parent="38_CK97VerlgJTxG9D-F-1">
          <mxGeometry x="-1560" y="-480" width="160" height="120" as="geometry" />
        </mxCell>
        <mxCell id="J5QdPYJSiRH2CUNcj6qU-0" value="ID token (JWT)" style="swimlane;whiteSpace=wrap;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="38_CK97VerlgJTxG9D-F-1">
          <mxGeometry x="-2400" y="-1040" width="240" height="160" as="geometry" />
        </mxCell>
        <mxCell id="J5QdPYJSiRH2CUNcj6qU-1" value="PersistentSession ID" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="J5QdPYJSiRH2CUNcj6qU-0">
          <mxGeometry x="10" y="40" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="J5QdPYJSiRH2CUNcj6qU-2" value="Expiration time" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="J5QdPYJSiRH2CUNcj6qU-0">
          <mxGeometry x="10" y="80" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="J5QdPYJSiRH2CUNcj6qU-3" value="Signature" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="J5QdPYJSiRH2CUNcj6qU-0">
          <mxGeometry x="10" y="120" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="J5QdPYJSiRH2CUNcj6qU-4" value="Authority" style="swimlane;whiteSpace=wrap;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="38_CK97VerlgJTxG9D-F-1">
          <mxGeometry x="-1800" y="-720" width="240" height="160" as="geometry" />
        </mxCell>
        <mxCell id="J5QdPYJSiRH2CUNcj6qU-5" value="UserAccount ID" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="J5QdPYJSiRH2CUNcj6qU-4">
          <mxGeometry x="10" y="40" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="J5QdPYJSiRH2CUNcj6qU-6" value="Roles" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="J5QdPYJSiRH2CUNcj6qU-4">
          <mxGeometry x="10" y="80" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="J5QdPYJSiRH2CUNcj6qU-7" value="Login time" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=14;" vertex="1" parent="J5QdPYJSiRH2CUNcj6qU-4">
          <mxGeometry x="10" y="120" width="220" height="40" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
